# Plan: Synopsis to Screenplay Workflow Engine

> **Feature**: synopsis-to-scenario
> **Created**: 2026-02-14
> **Status**: Draft
> **PDCA Phase**: Plan

---

## 1. 목표 (Objective)

다양한 형식의 원작(숏폼, 웹드라마, 소설, 웹툰, 실화 등)을 **한국어 장편 영화 시나리오**로 전환하는 멀티 에이전트 워크플로우 엔진 구축.

### 성공 기준
- [ ] 시놉시스 입력 → 완성 시나리오(.docx/.pdf) 출력까지 전체 파이프라인 동작
- [ ] 9단계(STEP 0-8) + 3개 체크포인트(A/B/C) 순차 실행
- [ ] Human-in-the-loop 피드백 → 해당 Step 재실행 가능
- [ ] 각 Step 산출물이 다음 Step에 컨텍스트로 전달
- [ ] 최종 산출물: 55~70페이지, 70~85씬 (90분 기준)

---

## 2. 기존 명세서 점검 (Spec Review)

### 2.1 잘 정의된 부분 ✅

| 항목 | 평가 | 비고 |
|------|------|------|
| 에이전트 역할 분리 | ✅ 우수 | Orchestrator/Analyst/Writer/Critic 4자 분리, 자기확증편향 방지 설계 |
| Step 간 데이터 의존성 | ✅ 명확 | 의존 그래프, 병렬 가능 구간(STEP 3-4) 명시 |
| 체크포인트 구조 | ✅ 체계적 | Critic 사전 리뷰 → Human 승인 2단계 게이트 |
| 이론적 기반 | ✅ 풍부 | 7명 이론가 + 한국 시나리오 전통 매핑 |
| 분량 설계 기준 | ✅ 실용적 | 씬 수 1차 지표, 한국/할리우드 차이 명시 |
| 비트 시트 템플릿 | ✅ 구체적 | 15비트, 시간대/씬 수까지 명시 |
| STEP 0 분석 프레임워크 | ✅ 범용적 | 6개 핵심 보완점 일반화 |
| STEP 8 개고 프로세스 | ✅ 구체적 | Linda Seger 6단계 프로세스 명시 |

### 2.2 보완이 필요한 부분 ⚠️

#### A. 기술 구현 명세 부재

| 누락 항목 | 중요도 | 설명 |
|-----------|--------|------|
| **기술 스택 미정** | 🔴 High | Python? TypeScript? LLM API(Claude/GPT)? 프레임워크? |
| **LLM 프롬프트 설계** | 🔴 High | 각 에이전트별 시스템 프롬프트, 토큰 관리 전략 없음 |
| **컨텍스트 윈도우 관리** | 🔴 High | STEP 7(1고 집필)에서 55~70페이지 분량이 컨텍스트 한계 초과 가능 |
| **상태 관리 / 체크포인트 저장** | 🟡 Medium | 중단-재개 메커니즘 미정 (파일? DB? 메모리?) |
| **산출물 파일 형식** | 🟡 Medium | .docx 생성 라이브러리, 시나리오 포맷팅 규칙 미정 |
| **에러 처리** | 🟡 Medium | LLM 응답 실패, 체크포인트 거부 시 재시도 로직 없음 |
| **UI/UX** | 🟡 Medium | CLI? Web? 사용자가 피드백을 어떤 인터페이스로 제공하는지 미정 |

#### B. 워크플로우 로직 보완점

| 항목 | 설명 |
|------|------|
| **STEP 3-4 병렬 실행 구체화** | "병렬 가능"으로 명시되었으나, 상호 참조 시 동기화 방법 미정 |
| **체크포인트 수정 범위** | "해당 Step 재실행"만 명시 — 수정이 후속 Step에 캐스케이딩되는 규칙 미정 |
| **버전 관리** | 수정 시 이전 버전 보존 여부, diff 제공 여부 미정 |
| **STEP 7 분할 전략** | 55~70페이지를 한 번에 생성 vs 막별/시퀀스별 분할 생성 미정 |
| **Critic 평가 기준 정량화** | pass/conditional_pass/rework_needed 판단의 구체 기준(점수? 체크리스트?) 미정 |

#### C. 프로젝트 범위 질문

| 질문 | 영향 |
|------|------|
| 단일 사용자 로컬 도구인가, 다중 사용자 서비스인가? | 아키텍처 전체 |
| 실시간 스트리밍 출력이 필요한가? | UX, LLM 호출 방식 |
| 원작 문서 형식은? (PDF, DOCX, 텍스트, 이미지) | 파서 구현 범위 |
| 작법 레퍼런스는 매번 업로드인가, 내장인가? | RAG/임베딩 필요 여부 |
| 예산/비용 제약이 있는가? | LLM 모델 선택, 호출 횟수 최적화 |

---

## 3. 리스크 분석 (Risk Assessment)

| 리스크 | 확률 | 영향 | 대응 방안 |
|--------|------|------|-----------|
| **컨텍스트 윈도우 초과** (STEP 7) | 높음 | 치명적 | 막별 분할 생성, 요약 패싱, 긴 컨텍스트 모델 활용 |
| **LLM 창작 품질 편차** | 높음 | 높음 | Critic 리뷰 루프, 재생성 로직, 프롬프트 반복 최적화 |
| **체크포인트 무한 루프** | 중간 | 중간 | 최대 수정 횟수 제한 (예: 3회) |
| **한국어 시나리오 형식 LLM 미숙** | 중간 | 높음 | Few-shot 예시, 형식 검증 후처리기 |
| **Step 간 정보 손실** | 중간 | 높음 | 구조화된 JSON 산출물, 명시적 컨텍스트 전달 |
| **산출물 .docx 포맷팅 오류** | 낮음 | 중간 | 템플릿 기반 생성, 시나리오 전용 스타일 정의 |

---

## 4. 구현 전략 제안 (Implementation Strategy)

### Option A: Claude 기반 대화형 워크플로우 (경량)

```
사용자 ↔ Claude (Orchestrator 역할)
         ├─ 프롬프트 전환으로 Analyst/Writer/Critic 역할 수행
         ├─ 체크포인트에서 사용자에게 직접 질문
         └─ 파일 시스템에 중간 산출물 저장
```

- **장점**: 즉시 구현 가능, 인프라 불필요
- **단점**: 컨텍스트 윈도우 제약, 자동화 한계
- **적합**: MVP / 프로토타입

### Option B: 멀티 에이전트 오케스트레이션 (중량)

```
Orchestrator (Python/TS)
  ├─ Analyst Agent (Claude API + 전용 프롬프트)
  ├─ Writer Agent  (Claude API + 전용 프롬프트)
  ├─ Critic Agent  (Claude API + 전용 프롬프트)
  ├─ State Manager (파일 시스템 / SQLite)
  └─ Document Generator (python-docx / pandoc)
```

- **장점**: 확장성, 에이전트별 프롬프트 최적화, 긴 워크플로우 안정적
- **단점**: 개발 기간 길어짐, API 비용 높음
- **적합**: 프로덕션 / 반복 사용

### Option C: 하이브리드 (권장)

Phase 1에서 Option A로 프로토타입 → 검증 후 Phase 2에서 Option B로 전환.

---

## 5. 우선순위 로드맵 (Prioritized Roadmap)

### Phase 1: 프로토타입 (MVP)
1. ProjectConfig 입력 처리
2. STEP 0-2 (분석 파이프라인) 구현
3. 체크포인트 A 피드백 루프
4. STEP 3-6 (시각 설계 + 씬 구축) 구현
5. 체크포인트 B, C 피드백 루프
6. STEP 7 (1고 집필) — 막별 분할 전략
7. STEP 8 (시각적 개고) 구현

### Phase 2: 안정화
8. .docx 출력 포맷팅
9. 상태 저장/재개 메커니즘
10. 프롬프트 최적화 (few-shot 예시 추가)

### Phase 3: 확장
11. 다양한 source_format 파서
12. 작법 레퍼런스 RAG 통합
13. Web UI (선택)

---

## 6. 결론 및 다음 단계

### 명세서 완성도 평가

| 영역 | 완성도 | 비고 |
|------|--------|------|
| 도메인 설계 (무엇을) | ⬛⬛⬛⬛⬛ 95% | 매우 우수 — 시나리오 작법 이론, 워크플로우 구조, 데이터 흐름 |
| 기술 설계 (어떻게) | ⬜⬜⬜⬜⬜ 10% | 미정 — 기술 스택, 프롬프트, 컨텍스트 관리, UI |
| 프로젝트 관리 | ⬜⬜⬜⬜⬜ 5% | 미정 — 일정, 리소스, 비용 추정 |

### 권장 다음 단계
1. **기술 스택 결정** → 구현 전략(A/B/C) 중 택일
2. **컨텍스트 윈도우 전략** → STEP 7 분할 방식 확정
3. **Design 문서 작성** → `/pdca design synopsis-to-scenario`
